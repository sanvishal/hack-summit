<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Health Care App</title>
  <link href="assets/styles.css" rel="stylesheet" />
  <link href="assets/form.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.5/css/bulma.min.css" />
  <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
  <!-- <link rel="stylesheet" href="/assets/bluma-switch.min.css"> -->
</head>

<body id="bg">

  <section class="hero is-fullheight is-bold is-text-centered" id="form-wrap">
    <div class="hero-body">
      <div class="container has-text-centered">
        <div class="container form-cont">
          <section class="hero">
            <div class="hero-body">
              <div class="row">
                <h1 class="title" id = "onSettingsChange">
                  Let's get started
                </h1>
                <h2 class="subtitle">
                  I respect your privacy <i class="fa fa-eye-slash"></i>
                </h2>
              </div>
            </div>
          </section>
          <section class="section form-controls-wrap">
            <div class="field">
              <label class="label">Name</label>
              <div class="control">
                <input class="input name-input" type="text" id="name-ipc"
                  placeholder="How would you like me to call you?" />
              </div>
            </div>
            <div class="field">
              <label class="label">Gender</label>
              <div class="control">
                <div class="select">
                  <select id="gender-ipc">
                    <option>Male</option>
                    <option>Female</option>
                    <option>Prefer not to specify</option>
                  </select>
                </div>
              </div>
            </div>
            <div class="divider"></div>
            <div class="field">
              <label class="label">Profession</label>
              <div class="control">
                <div class="select">
                  <select id="prof-ipc">
                    <option>Developer</option>
                    <option>Designer</option>
                    <option>Editor</option>
                    <option>Gamer</option>
                  </select>
                </div>
              </div>
            </div>
            <div class="field">
              <label class="label">How do you sit?</label>
              <div class="control">
                <label class="radio" style="margin-right:45px">
                  <input type="radio" id="standing-desk-ipc" name="question" style="margin-right:5px" />
                  I have a standing desk
                </label>
                <label class="radio">
                  <input type="radio" id="sit-ipc" name="question" style="margin-right:5px" checked />
                  I don't
                </label>
              </div>
            </div>
            <div class="columns">
              <div class="field column">
                <label class="label">Room Space</label>
                <div class="control">
                  <div class="select">
                    <select id="room-ipc">
                      <option>Small - Sit/Stand Exercises</option>
                      <option>Large - Lay Down Exercises</option>
                    </select>
                  </div>
                </div>
              </div>
              <div class="field column">
                <label class="label">Free time to spare</label>
                <div class="control">
                  <div class="select">
                    <select id="free-ipc">
                      <option>less than 5mins</option>
                      <option>more than 5mins</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
          </section>
          <div style="padding-top: 35px;">
            <button class="button submit-btn" id="submit-btn">
              Submit <i class="fa fa-check"></i>
            </button>
          </div>
          <div class="form-footer has-text-centered">
            ps..you can edit these later in the settings
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="section" id="dashboard-wrap">
    <div class="container">

      <div class="columns">
        <div class="column">
          <div style="float: left">
            <h1 class="title" id="text">
              <span class="icon has-text-danger" style="margin: 5px;">
                <i class="far fa-user"></i>
              </span>
              <span id="name">Hi User</span>
            </h1>
          </div>
        </div>
        <div class="column">
          <div style="float: left" id="text">

            <span class="icon has-text-danger" style="margin: 3px;">
              <i class="far fa-bell"></i>
            </span>
            <label class="switch">
              <input id="quit" type="checkbox" checked />
              <span class="slider round"></span>
            </label>


          </div>
          <div style="float: right">
            <h2 class="subtitle circle" id="text">
              <span id = "settings" class="icon has-text-danger" style="margin: 3px;">
                <i class="fas fa-wrench"></i>
              </span>
            </h2>
          </div>
        </div>
      </div>

      <div class="dashboard">
        <div class="columns">
          <div class="column">
            Typing Frequency<br />
            <span class="title" id="freq-span" style="color:#eb3498">0</span>
            <span class="subtitle" style="color: aliceblue"> CPM</span>
            <br />
            WhoA Lorem ipsum dolor sit amet..
          </div>
          <div class="column">
            Usage Time<br />
            <span class="title" id="usage-span" style="color: #eb3498">0</span>
            <span class="subtitle" style="color: aliceblue"> Hours</span><br />
            WhoA Lorem ipsum dolor sit amet..
          </div>
          <div class="column">
            Resting Time <br />
            <span class="title" id="rest-span" style="color: #eb3498">0</span>
            <span class="subtitle" style="color: aliceblue"> Minutes</span><br />
            WhoA Lorem ipsum dolor sit amet..
          </div>
          <div class="column" id="workoutCount">
            Workouts <br />
            <span class="title" style="color: #eb3498">10</span>
            <span class="subtitle" style="color: aliceblue"> workouts</span><br />
            WhoA Lorem ipsum dolor sit amet..
          </div>
        </div>
      </div>

      <br />

      <div class="dashboard2">
        <div class="columns">
          <div class="column">
            <h1 class="title">Tips</h1>
            <span class="subtitle">Eye Care</span>
            <li>
              Apply Castor Oil and Olive oil while going to bed this reduces the stress on your eye, nourishes your
              eye sight
            </li><br>
            <span class="subtitle">Back Care</span>
            <li>
              Keep Good Posture, Maintain Healthy weight, do stretches often
              Apply Heat and cold
            </li>
          </div>
          <div class="column"><span class="title">Our Excecise Plan for You</span></div>

        </div>

      </div>

      <!-- <div class="dashboard2"><span class="titl">Graphical Analysis</span></div> -->

    </div>
  </section>
  <script>
    const electron = require("electron");
    const ioHook = require("iohook");
    const os = require("os");
    const deasync = require("deasync");
    const db = require("./db");
    const uptime2 = require("os-uptime");
    const { ipcRenderer } = electron;

    // Wait  Ffor a promise without using the await
    function wait(promise) {
      var done = 0;
      var result = null;
      promise.then(
        // on value
        function (value) {
          done = 1;
          result = value;
          return value;
        },
        // on exception
        function (reason) {
          done = 1;
          throw reason;
        }
      );

      while (!done) deasync.runLoopOnce();

      return result;
    }

    const UserDetails = () => {
      const obj = wait(db.userinfo.find({}));
      return obj;
    };

    const getUserDetails = () => {
      return UserDetails()[0].data;
    };

    var User = getUserDetails();
    let name = document.getElementById("name");
    name.innerHTML = `Hi ${User.name}`;

    let usage = document.getElementById("usage-span");
    let rest = document.getElementById("rest-span");
    let freq = document.getElementById("freq-span");
    let quit = document.getElementById("quit");

    quit.addEventListener("click", (e) => {
      var bool = document.getElementById("quit").checked;
      if (!bool) {
        ipcRenderer.send("no:notifs", 1);
      } else {
        ipcRenderer.send("yes:notifs", 1);
      }
    });

    let settings = document.getElementById("settings");

    settings.addEventListener("click", (e) => {
      document.getElementById("dashboard-wrap").style.display = "none";
      document.getElementById("form-wrap").style.display = "block";
    })

    let cpm = 0,
      cpmavg = 0,
      avgcnt = 1,
      mincnt = 0;

    let uptime = (os.uptime() / (60 * 60)).toString().split("."),
      integ = uptime[0],
      dec = uptime[1];
    usage.innerText = integ + "." + dec.slice(0, 2);
    console.log(os.uptime());
    ioHook.on("keyup", event => {
      // keys.innerText += "  " + String.fromCharCode(event.rawcode);
      cpm++;
    });

    setInterval(function () {
      cpmavg = (cpm + cpmavg) / 2;
      if (Math.floor(cpmavg) == 0) {
        mincnt++;
      }
      console.log(mincnt, Math.floor(cpmavg));
      freq.innerText = Math.floor(cpmavg);
      rest.innerText = mincnt;
      cpm = 0;
    }, 2000);
    ioHook.start();
  </script>
  <script src="mwctrl.js"></script>
  <script src="notifs.js"></script>
  <!-- <script src="temp.js"></script> -->
</body>

</html>